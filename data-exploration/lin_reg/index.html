<html>
<head>
	<meta charset='utf-8' />
	<title>Linear Regression</title>
	<script src="../lib/d3.v5.min.js"></script>
	<script src="../lib/topojson.v2.min.js"></script>
	<script src="../lib/d3-scale-chromatic.v1.min.js"></script>
	<script src="../lib/d3-simple-slider.min.js"></script>
	<script src="../lib/d3-tip.min.js"></script>
	<link rel='stylesheet' href='../../../css/styles.css'>
	<style>
	.states path {
  stroke: #ffffff;
  stroke-linejoin: round;
}
		
	
		
	</style>
</head>
<body>
<script>


	
	var margin = {top: 50, right: 250, bottom: 50, left: 50};
	var width = 950 - margin.left - margin.right,
    height = 750 - margin.top - margin.bottom;
	
	
	
	

	
	var dateParse = d3.timeParse("%m/%d/%Y");
	var yearParse = d3.timeParse("%Y");
	

	var dataParse = function(d) {
		for(x in d) {
			d[x] = parseFloat(d[x]);
		}
		return d;
	}
	
	var modelParse = function(d) {
		for(x in d) {
			d[x] = parseFloat(d[x]);
		}
		return d;
	}
	


	

	var promises = [d3.csv("data/lin_reg_data.csv",dataParse),d3.csv("data/lin_reg_model.csv",modelParse)];

	
	Promise.all(promises).then(function([data,model]) {

		console.log(data);
		console.log(model);
		
		model = model[0];
		
		var colors = d3.schemeCategory10;
	
		
			var predict = function(d) {
		var sum = model.Bias;
		for(x in d) {
			if(x=="householdDebt") continue;
			sum += d[x]*model[x];
		}
				return sum;
		}
	
		
		
		var predictions = data.map(predict);
		
		var base = d3.select("body").insert("svg",".description")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom);
		
		var svg = base.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

console.log(predictions);
		
	var xScale,yScale;
		
		xScale = d3.scaleLinear().domain([0,data.length-1]).range([0,width]);
		yScale = d3.scaleLinear().domain([-25,25]).range([height,0]);
		
			
		var line_debt = d3.line()
		.x(function(d, i) { return xScale(i); }) // set the x values for the line generator
		.y(function(d) { return yScale(d.householdDebt); }) // set the y values for the line generator 
		.curve(d3.curveMonotoneX) // apply smoothing to the line
		
		svg.append("path")
		.attr("class","line")
		.attr("stroke","blue")
		.attr("stroke-width",3)
		.attr("fill","none")
		.datum(data) // 10. Binds data to the line 
		.attr("d", line_debt); 
		
				var line_pred = d3.line()
		.x(function(d, i) { return xScale(i); }) // set the x values for the line generator
		.y(function(d) { return yScale(d); }) // set the y values for the line generator 
		.curve(d3.curveMonotoneX) // apply smoothing to the line
		
		svg.append("path")
		.attr("class","line")
		.attr("stroke","black")
		.attr("stroke-width",3)
		.attr("stroke-dasharray","3 3")
		.attr("fill","none")
		.datum(predictions) // 10. Binds data to the line 
		.attr("d", line_pred); // 11. Calls the line generator
		
			
		var sorted = [];
		for(var x in model) {
			var endVal = 0;
			if(x=="Bias") endVal = model.Bias;
			else endVal = data[data.length-1][x]*model[x];
			var obj = {key:x,val:endVal};
			sorted.push(obj);
		}
		sorted = sorted.sort((a,b)=>Math.sign(b.val-a.val)).map(x=>x.key);
		

		for(var i in sorted) {
			var key = sorted[i];
			if(key=="Bias") {
		
		svg.append("line")
		.attr("class","line")
		.attr("stroke",colors[i])
		.attr("fill","none")
		.attr("x1", xScale(0))
		.attr("x2",xScale(data.length-1))
		.attr("y1",yScale(model.Bias))
		.attr("y2",yScale(model.Bias));
				
	
			}
			else {
			var line = d3.line()
		.x(function(d, i) { return xScale(i); }) // set the x values for the line generator
		.y(function(d) { return yScale(d[key]*model[key]); }) // set the y values for the line generator 
		.curve(d3.curveMonotoneX) // apply smoothing to the line
		
		svg.append("path")
		.attr("class","line")
		.attr("stroke",colors[i])
		.attr("fill","none")
		.datum(data) // 10. Binds data to the line 
		.attr("d", line);
				
		

			}
			
			svg.append("rect")
			.attr("fill",colors[i])
			.attr("x",width+25)
			.attr("y",i*25)
			.attr("width",25)
			.attr("height",10);
			
			svg.append("text")
			.attr("x",width+50+12)
			.attr("dominant-baseline","middle")
			.attr("y",i*25+5)
			.text(key);
			
	
		}
		

		
		

		svg.append("g").call(d3.axisLeft(yScale));
	svg.append("g")
		.attr("transform", "translate(0," + height + ")")
		.call(d3.axisBottom(xScale));
		
	
	
		
		
	});
	
	
		
	



</script>
</body>
</html>